<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é›¨é›²ã‚¢ãƒ©ãƒ¼ãƒˆPWA</title>
</head>
<body>
  <h1>ç¾åœ¨åœ°ã‚’å–å¾—ä¸­...</h1>
  <p id="location">ä½ç½®æƒ…å ±ã‚’å–å¾—ä¸­...</p>

  <script>
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude.toFixed(5);
          const lon = position.coords.longitude.toFixed(5);
          document.getElementById("location").innerText = `ç·¯åº¦: ${lat}, çµŒåº¦: ${lon}`;
        },
        function (error) {
          document.getElementById("location").innerText = "ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        }
      );
    } else {
      document.getElementById("location").innerText = "ã“ã®ç«¯æœ«ã§ã¯ä½ç½®æƒ…å ±ãŒä½¿ãˆã¾ã›ã‚“ã€‚";
    }
  </script>
</body>
</html>
<script>
  const API_KEY = "c315e6a4e6062a00144859053ad81298";

  function checkWeather(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ja`;

    fetch(url)
      .then((response) => response.json())
      .then((data) => {
        const weather = data.weather[0].description;
        const rain = data.rain ? data.rain["1h"] : 0;
        const message = `ç¾åœ¨ã®å¤©æ°—: ${weather} / 1æ™‚é–“ã®é™æ°´é‡: ${rain}mm`;
        document.getElementById("weather").innerText = message;

        if (rain > 0) {
          alert("é›¨ãŒé™ã£ã¦ã„ã¾ã™ â˜”");
        }
      })
      .catch((error) => {
        document.getElementById("weather").innerText = "å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        console.error(error);
      });
  }

  // ä½ç½®æƒ…å ±å–å¾—
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(
      function (position) {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        document.getElementById("location").innerText = `ç·¯åº¦: ${lat}, çµŒåº¦: ${lon}`;

        // å¤©æ°—ç¢ºèª
        checkWeather(lat, lon);
      },
      function () {
        document.getElementById("location").innerText = "ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    );
  }
</script>
<p id="weather">å¤©æ°—æƒ…å ±ã‚’å–å¾—ä¸­...</p>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>

<script>
  // ğŸ” Firebaseè¨­å®šæƒ…å ±ã‚’è²¼ã‚Šä»˜ã‘
  const firebaseConfig = {
  const firebaseConfig = {
    apiKey: "AIzaSyAQfpDbzBtwthel8EIGeQHCG20Rtx8WIco",
    authDomain: "amagumo-alert.firebaseapp.com",
    projectId: "amagumo-alert",
    storageBucket: "amagumo-alert.firebasestorage.app",
    messagingSenderId: "712564051019",
    appId: "1:712564051019:web:95bf9c36bd08dfff8b11ce"
};

  firebase.initializeApp(firebaseConfig);

  const messaging = firebase.messaging();

  // é€šçŸ¥ã®è¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  messaging.requestPermission().then(() => {
    console.log("é€šçŸ¥ã®è¨±å¯ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸ");

    return messaging.getToken({ vapidKey: "YOUR_PUBLIC_VAPID_KEY" });
  }).then((token) => {
    console.log("å–å¾—ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³:", token);
    // â†’ ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦é€šçŸ¥é€ä¿¡ã™ã‚‹
  }).catch((err) => {
    console.error("é€šçŸ¥ã®è¨±å¯ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸ:", err);
  });

  // ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€šçŸ¥
  messaging.onMessage((payload) => {
    alert("é€šçŸ¥ã‚’å—ä¿¡ã—ã¾ã—ãŸ: " + payload.notification.title);
  });
</script>
